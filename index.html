<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>LeapReplica - Electric Vehicles</title>
  <link rel="stylesheet" href="css/style.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <a href="/" class="brand">LeapReplica</a>
      <nav class="site-nav" id="site-nav">
        <a href="index.html">Home</a>
        <a href="products.html">Products</a>
        <a href="about.html">About</a>
        <a href="contact.html">Contact</a>
      </nav>
      <button class="nav-toggle" id="nav-toggle" aria-label="Toggle navigation">â˜°</button>
    </div>
  </header>

  <main>
    <section class="hero">
      <div class="container hero-inner">
        <div class="hero-copy">
          <h1>Electric mobility, designed for the future.</h1>
          <p>Explore a new generation of electric vehicles with long range, smart features, and bold design.</p>
          <p><a class="btn" href="products.html">View Models</a></p>
        </div>
        <div class="hero-media">
          <img src="assets/car-hero.jpg" alt="Electric car mockup">
        </div>
      </div>
    </section>

    <section class="highlights">
      <div class="container">
        <h2>Featured Models</h2>
        <div class="cards">
          <article class="card">
            <img src="assets/model-a.jpg" alt="Model A">
            <h3>Model A</h3>
            <p>Long range, fast charging, advanced driver assistance.</p>
            <p><a class="link" href="products.html">Learn more</a></p>
          </article>

          <article class="card">
            <img src="assets/model-b.jpg" alt="Model B">
            <h3>Model B</h3>
            <p>Urban performance with compact design and premium interior.</p>
            <p><a class="link" href="products.html">Learn more</a></p>
          </article>

          <article class="card">
            <img src="assets/model-c.jpg" alt="Model C">
            <h3>Model C</h3>
            <p>An intelligent SUV with family-friendly range and space.</p>
            <p><a class="link" href="products.html">Learn more</a></p>
          </article>
        </div>
      </div>
    </section>

    <section class="about-teaser">
      <div class="container">
        <h2>Our Vision</h2>
        <p>We build electric vehicles that are safe, sustainable and delightful to drive. Technology and design come together to make mobility more efficient and enjoyable.</p>
        <p><a class="btn ghost" href="about.html">Learn about us</a></p>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container">
      <div>Â© 2025 LeapReplica</div>
      <nav class="foot-nav">
        <a href="privacy.html">Privacy</a>
        <a href="contact.html">Contact</a>
      </nav>
    </div>
  </footer>

  <script src="js/main.js"></script>
	<script type='text/javascript'>
  function initEmbeddedMessaging() {
    try {
      // Get country code from URL path
      var path = window.location.pathname;
      var pathParts = path.split('/').filter(function(part) { return part.length > 0; });
      var countryCode = 'en'; // default
      
      if (pathParts.length > 0) {
        countryCode = pathParts[0].toLowerCase();
      }
      
      // Country mapping for prechat fields
      var countryMapping = {
        'it': { name: 'Italy', language: 'it', code: 'it' },
        'es': { name: 'Spain', language: 'es', code: 'es' },
        'fr': { name: 'France', language: 'fr', code: 'fr' },
        'de': { name: 'Germany', language: 'de', code: 'de' },
        'uk': { name: 'United Kingdom', language: 'en-US', code: 'uk' },
        'us': { name: 'United States', language: 'en-US', code: 'us' },
        'en': { name: 'United States', language: 'en-US', code: 'en' }
      };
      
      var countryInfo = countryMapping[countryCode] || countryMapping['en'];
      
      // Set language dynamically based on country code
      embeddedservice_bootstrap.settings.language = countryInfo.language;
      embeddedservice_bootstrap.settings.shouldOpenLinksInSameTab = true;
      embeddedservice_bootstrap.settings.hideChatButtonOnLoad = true;
      
      console.log('Detected country code:', countryCode, '| Setting language to:', countryInfo.language);
      
      window.addEventListener("onEmbeddedMessagingReady", () => {
        embeddedservice_bootstrap.prechatAPI.setHiddenPrechatFields({
          Country: countryInfo.name,
          Language: countryInfo.language,
          CountryCode: countryInfo.code,
        });
      });
      
      embeddedservice_bootstrap.init(
        "00DMA000003XnGM",
        "LPM_Leapmotor",
        "https://leapmotor--dev01.sandbox.my.site.com/ESWLPMLeapmotor1760706603231",
        {
          scrt2URL: "https://leapmotor--dev01.sandbox.my.salesforce-scrt.com",
        }
      );
    } catch (err) {
      console.error("Error loading Embedded Messaging: ", err);
    }
  }
  
  (function () {
    console.log("Test custom chat button with Leapmotor carousel");
    
    // Get country code from URL path
    function getCountryFromURL() {
      var path = window.location.pathname;
      var pathParts = path.split('/').filter(function(part) { return part.length > 0; });
      
      if (pathParts.length > 0) {
        var countryCode = pathParts[0].toLowerCase();
        return countryCode;
      }
      return 'en';
    }
    
    // Get localized message based on country
    function getLocalizedMessage(countryCode) {
      var messages = {
        'it': 'Chatta con me!',
        'es': 'Â¡Chatea conmigo!',
        'fr': 'Discutez avec moi!',
        'de': 'Chatte mit mir!',
        'uk': 'Chat with me!',
        'us': 'Chat with me!',
        'en': 'Chat with me!'
      };
      return messages[countryCode] || messages['en'];
    }
    
    // Get localized popup message
    function getLocalizedPopupMessage(countryCode) {
      var popupMessages = {
        'it': 'ðŸ‘‹ Ciao! Hai bisogno di aiuto? Prova la nostra chat!',
        'es': 'ðŸ‘‹ Â¡Hola! Â¿Necesitas ayuda? Â¡Prueba nuestro chat!',
        'fr': 'ðŸ‘‹ Bonjour! Besoin d\'aide? Essayez notre chat!',
        'de': 'ðŸ‘‹ Hallo! Brauchen Sie Hilfe? Probieren Sie unseren Chat!',
        'uk': 'ðŸ‘‹ Hi! Need help? Try our chat!',
        'us': 'ðŸ‘‹ Hi! Need help! Try our chat!',
        'en': 'ðŸ‘‹ Hi! Need help? Try our chat!'
      };
      return popupMessages[countryCode] || popupMessages['en'];
    }
    
    // Get localized toggle button messages
    function getLocalizedToggleMessages(countryCode) {
      var toggleMessages = {
        'it': { open: 'Apri Chat', close: 'Chiudi Chat' },
        'es': { open: 'Abrir Chat', close: 'Cerrar Chat' },
        'fr': { open: 'Ouvrir Chat', close: 'Fermer Chat' },
        'de': { open: 'Chat Ã–ffnen', close: 'Chat SchlieÃŸen' },
        'uk': { open: 'Open Chat', close: 'Close Chat' },
        'us': { open: 'Open Chat', close: 'Close Chat' },
        'en': { open: 'Open Chat', close: 'Close Chat' }
      };
      return toggleMessages[countryCode] || toggleMessages['en'];
    }
    
    var detectedCountry = getCountryFromURL();
    var buttonMessage = getLocalizedMessage(detectedCountry);
    var popupMessage = getLocalizedPopupMessage(detectedCountry);
    var toggleMessages = getLocalizedToggleMessages(detectedCountry);
    console.log('Detected country:', detectedCountry, '| Message:', buttonMessage);
    
    var chatClicked = false;
    var popupInterval = null;
    var embeddedServiceInstance = null;
    var isChatButtonVisible = true;  // Track button visibility
    
    // Create notification sound using Web Audio API
    function playNotificationSound() {
      try {
        var audioContext = new (window.AudioContext || window.webkitAudioContext)();
        var oscillator = audioContext.createOscillator();
        var gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        oscillator.frequency.value = 800;
        oscillator.type = 'sine';
        
        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
        
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.5);
        
        console.log('Notification sound played');
      } catch (e) {
        console.warn('Could not play notification sound:', e);
      }
    }
    
    function hideStandardButton(es) {
      if (es && es.utilAPI && typeof es.utilAPI.hideChatButton === "function") {
        try {
          es.utilAPI.hideChatButton();
          console.log("hideChatButton() called");
        } catch (e) {
          console.warn("Error calling hideChatButton()", e);
        }
      }
    }
    
    function showCustomCTA(es) {
      if (!es || !es.utilAPI) {
        console.warn("utilAPI not available");
        return;
      }
      
      var existing = document.getElementById("leap-chat-cta");
      if (existing) {
        existing.style.display = "inline-flex";
        hideStandardButton(es);
        console.log("Custom CTA shown again");
        return;
      }
      
      // Create button container
      var btn = document.createElement("button");
      btn.id = "leap-chat-cta";
      btn.style.position = "fixed";
      // Responsive positioning - smaller margins on smaller screens
      if (window.innerWidth <= 480) {
        // Mobile
        btn.style.right = "6px";
        btn.style.bottom = "12px";
      } else if (window.innerWidth <= 768) {
        // Tablet
        btn.style.right = "8px";
        btn.style.bottom = "16px";
      } else {
        // Desktop
        btn.style.right = "10px";
        btn.style.bottom = "24px";
      }
      btn.style.zIndex = "99999";
      btn.style.padding = "11px 39px";  // Reduced from 14px (20% reduction)
      btn.style.fontSize = "22px";
      btn.style.fontWeight = "700";
      btn.style.borderRadius = "999px";  // Unchanged
      btn.style.border = "none";
      btn.style.cursor = "pointer";
      btn.style.boxShadow = "0 12px 32px rgba(0,0,0,0.3), 0 0 40px rgba(100, 160, 40, 0.4)";
      btn.style.background = "#64a028";  // Solid green color
      btn.style.backgroundSize = "200% 200%";
      btn.style.color = "#ffffff";
      btn.style.display = "inline-flex";
      btn.style.alignItems = "center";
      btn.style.justifyContent = "center";
      btn.style.gap = "18px";
      btn.style.transition = "all 0.3s ease";
      btn.style.overflow = "visible";
      btn.style.fontFamily = "'Arial', sans-serif";
      btn.style.textShadow = "3px 3px 6px rgba(0,0,0,0.4)";
      btn.style.minWidth = "284px";  // Reduced from 315px (10% smaller)
      btn.style.minHeight = "77px";  // Reduced from 85px (10% smaller)
      
      // Leapmotor car images carousel - Rounded rectangle format
      var iconContainer = document.createElement("div");
      iconContainer.style.position = "relative";
      iconContainer.style.width = "85px";  // Reduced from 100px (proportional to button)
      iconContainer.style.height = "60px";  // Reduced from 70px
      iconContainer.style.display = "flex";
      iconContainer.style.alignItems = "center";
      iconContainer.style.justifyContent = "center";
      iconContainer.style.overflow = "hidden";
      
      // Car image URLs - Replace these with your actual Leapmotor car images
      var carImages = [
        { name: 'model1', url: 'assets/model1.png'},
        { name: 'model2', url: 'assets/model2.png'},
        { name: 'model3', url: 'assets/model3.png'},
        { name: 'model4', url: 'assets/model4.png'},
        { name: 'model5', url: 'assets/model5.png'}
      ];
      var currentCarIndex = 0;
      
      var carImg = document.createElement("img");
      carImg.src = carImages[0].url;
      carImg.alt = carImages[0].name;
      carImg.style.width = "100%";
      carImg.style.height = "100%";
      carImg.style.objectFit = "contain";
      carImg.style.display = "block";
      carImg.style.transition = "opacity 0.5s ease, transform 0.3s ease";
      // Rounded rectangle format with subtle background
      carImg.style.filter = "drop-shadow(0 3px 8px rgba(0,0,0,0.2)) brightness(1.15) contrast(1.08) saturate(1.1)";
      carImg.style.background = "rgba(255, 255, 255, 0.15)";  // Subtle semi-transparent white
      carImg.style.borderRadius = "16px";  // Rounded rectangle
      carImg.style.padding = "8px";  // Padding for breathing room
      carImg.style.border = "1px solid rgba(255, 255, 255, 0.2)";
      carImg.style.boxShadow = "inset 0 1px 2px rgba(255,255,255,0.3)";
      carImg.style.backdropFilter = "blur(10px)";  // Glassmorphism effect
      iconContainer.appendChild(carImg);
      
      // Text content with localized message
      var textSpan = document.createElement("span");
      textSpan.textContent = buttonMessage;
      textSpan.style.letterSpacing = "0.5px";
      
      // Leapmotor logo - Much bigger, seamlessly blended
      var logoImg = document.createElement("img");
      logoImg.src = "assets/Leapmotor.png";
      logoImg.alt = "Leapmotor";
      logoImg.style.height = "42px";  // Reduced from 50px (proportional)
      logoImg.style.width = "auto";
      logoImg.style.objectFit = "contain";
      logoImg.style.marginLeft = "16px";
      logoImg.style.opacity = "1";
      // Seamless blending with button background
      logoImg.style.filter = "drop-shadow(0 3px 10px rgba(0,0,0,0.2)) brightness(1.25) contrast(1.08)";
      logoImg.style.background = "transparent";
      logoImg.style.padding = "0";
      logoImg.style.borderRadius = "0";
      logoImg.style.border = "none";
      logoImg.style.boxShadow = "none";
      
      btn.appendChild(iconContainer);
      btn.appendChild(textSpan);
      btn.appendChild(logoImg);
      
      // Add CSS animations
      var style = document.createElement("style");
      style.textContent = `
        @keyframes carFadeIn {
          0% { opacity: 0; transform: scale(0.8); }
          100% { opacity: 1; transform: scale(1); }
        }
        
        @keyframes carFadeOut {
          0% { opacity: 1; transform: scale(1); }
          100% { opacity: 0; transform: scale(0.8); }
        }
        
        @keyframes energyParticle {
          0% { transform: translateY(-10px) translateX(0) rotate(0deg); opacity: 0; }
          50% { opacity: 1; }
          100% { transform: translateY(10px) translateX(5px) rotate(180deg); opacity: 0; }
        }
        
        @keyframes energyFlow {
          0% { background-position: 0% 50%; }
          50% { background-position: 100% 50%; }
          100% { background-position: 0% 50%; }
        }
        
        @keyframes electricPulse {
          0%, 100% { transform: scale(1); box-shadow: 0 12px 32px rgba(0,0,0,0.3), 0 0 40px rgba(0, 150, 255, 0.3); }
          50% { transform: scale(1.02); box-shadow: 0 12px 32px rgba(0,0,0,0.3), 0 0 50px rgba(0, 200, 255, 0.5); }
        }
        
        @keyframes popupSlideIn {
          0% { opacity: 0; transform: translateY(20px) scale(0.8); }
          100% { opacity: 1; transform: translateY(0) scale(1); }
        }
        
        @keyframes popupBounce {
          0%, 100% { transform: translateY(0); }
          50% { transform: translateY(-5px); }
        }
        
        #leap-chat-cta {
          animation: energyFlow 3s ease infinite, electricPulse 2s ease-in-out infinite;
        }
        
        #leap-chat-cta:hover {
          transform: scale(1.08) !important;
          box-shadow: 0 12px 32px rgba(0,0,0,0.4), 0 0 60px rgba(0, 200, 255, 0.6) !important;
        }
        
        .chat-popup-tooltip {
          position: fixed;
          right: 32px;
          bottom: 140px;
          background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%);
          color: #333;
          padding: 16px 24px;
          border-radius: 16px;
          box-shadow: 0 8px 24px rgba(0,0,0,0.3), 0 0 40px rgba(196, 30, 58, 0.2);
          z-index: 99998;
          max-width: 280px;
          font-family: 'Arial', sans-serif;
          font-size: 15px;
          font-weight: 600;
          animation: popupSlideIn 0.5s ease, popupBounce 1.5s ease-in-out 0.5s infinite;
          border: 3px solid #0066cc;
          cursor: pointer;
          transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .chat-popup-tooltip:hover {
          transform: translateY(-2px);
          box-shadow: 0 12px 32px rgba(0,0,0,0.4), 0 0 50px rgba(196, 30, 58, 0.3);
        }
        
        .chat-popup-tooltip::after {
          content: '';
          position: absolute;
          bottom: -12px;
          right: 40px;
          width: 0;
          height: 0;
          border-left: 12px solid transparent;
          border-right: 12px solid transparent;
          border-top: 12px solid #0066cc;
        }
        
        .chat-popup-close {
          position: absolute;
          top: 8px;
          right: 8px;
          background: #0066cc;
          color: white;
          border: none;
          border-radius: 50%;
          width: 24px;
          height: 24px;
          font-size: 16px;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          font-weight: bold;
          line-height: 1;
        }
        
        .chat-popup-close:hover {
          background: #0052a3;
        }
      `;
      document.head.appendChild(style);
      
      // Car carousel rotation
      setInterval(function () {
        carImg.style.opacity = "0";
        
        setTimeout(function () {
          currentCarIndex = (currentCarIndex + 1) % carImages.length;
          carImg.src = carImages[currentCarIndex].url;
          carImg.alt = carImages[currentCarIndex].name;
          carImg.style.opacity = "1";
          console.log('Showing car:', carImages[currentCarIndex].name);
        }, 500);
      }, 3000);
      
      // Energy particles effect (replacing snowflakes)
      function createEnergyParticle() {
        var particle = document.createElement("div");
        particle.textContent = "âš¡";  // Lightning bolt emoji
        particle.style.position = "absolute";
        particle.style.fontSize = "16px";
        particle.style.color = "#00d4ff";
        particle.style.pointerEvents = "none";
        particle.style.animation = "energyParticle 2s linear";
        particle.style.left = Math.random() * 100 + "%";
        particle.style.top = "-10px";
        particle.style.opacity = "0";
        
        btn.appendChild(particle);
        
        setTimeout(function () {
          if (particle.parentNode) {
            particle.parentNode.removeChild(particle);
          }
        }, 2000);
      }
      
      // Removed energy particles animation for cleaner look
      // setInterval(createEnergyParticle, 1000);
      
      btn.addEventListener("mouseenter", function () {
        btn.style.transform = "scale(1.08)";
      });
      
      btn.addEventListener("mouseleave", function () {
        btn.style.transform = "scale(1)";
      });
      
      btn.addEventListener("click", function () {
        chatClicked = true;
        hidePopupTooltip();
        stopPopupInterval();
        
        if (typeof embeddedServiceInstance.utilAPI.launchChat === "function") {
          console.log("launchChat() from CTA");
          var r = embeddedServiceInstance.utilAPI.launchChat();
          if (r && typeof r.then === "function") {
            r.then(function () {
              console.log("Chat launched (Promise resolved)");
            }).catch(function (err) {
              console.error("Error launching chat", err);
            });
          }
        } else {
          console.warn("launchChat() not available");
        }
      });
      
      document.body.appendChild(btn);
      hideStandardButton(es);
      embeddedServiceInstance = es;
      console.log("Custom CTA created with Leapmotor electric car carousel");
      
      // Create toggle button
      createToggleButton();
      
      startPopupInterval();
    }
    
    // Create toggle button to show/hide main chat button
    function createToggleButton() {
      var toggleBtn = document.createElement("button");
      toggleBtn.id = "chat-toggle-btn";
      toggleBtn.textContent = toggleMessages.close;
      
      // Positioning
      toggleBtn.style.position = "fixed";
      if (window.innerWidth <= 480) {
        toggleBtn.style.right = "6px";
        toggleBtn.style.bottom = "95px";  // Moved up from 105px
      } else if (window.innerWidth <= 768) {
        toggleBtn.style.right = "8px";
        toggleBtn.style.bottom = "100px";  // Moved up from 110px
      } else {
        toggleBtn.style.right = "10px";
        toggleBtn.style.bottom = "105px";  // Moved up from 115px
      }
      
      // Styling
      toggleBtn.style.zIndex = "99999";
      toggleBtn.style.padding = "8px 16px";
      toggleBtn.style.fontSize = "14px";
      toggleBtn.style.fontWeight = "600";
      toggleBtn.style.borderRadius = "20px";
      toggleBtn.style.border = "2px solid #64a028";
      toggleBtn.style.cursor = "pointer";
      toggleBtn.style.backgroundColor = "#ffffff";
      toggleBtn.style.color = "#64a028";
      toggleBtn.style.boxShadow = "0 4px 12px rgba(0,0,0,0.2)";
      toggleBtn.style.transition = "all 0.3s ease";
      toggleBtn.style.fontFamily = "'Arial', sans-serif";
      
      // Hover effect
      toggleBtn.addEventListener("mouseenter", function() {
        toggleBtn.style.backgroundColor = "#64a028";
        toggleBtn.style.color = "#ffffff";
        toggleBtn.style.transform = "scale(1.05)";
      });
      
      toggleBtn.addEventListener("mouseleave", function() {
        toggleBtn.style.backgroundColor = "#ffffff";
        toggleBtn.style.color = "#64a028";
        toggleBtn.style.transform = "scale(1)";
      });
      
      // Toggle functionality
      toggleBtn.addEventListener("click", function() {
        // Hide popup when toggle button is clicked
        hidePopupTooltip();
        
        var mainBtn = document.getElementById("leap-chat-cta");
        if (mainBtn) {
          if (isChatButtonVisible) {
            // Hide main button
            mainBtn.style.display = "none";
            toggleBtn.textContent = toggleMessages.open;
            isChatButtonVisible = false;
            stopPopupInterval();  // Stop popup when button is hidden
          } else {
            // Show main button
            mainBtn.style.display = "inline-flex";
            toggleBtn.textContent = toggleMessages.close;
            isChatButtonVisible = true;
            startPopupInterval();  // Restart popup when button is shown
          }
        }
      });
      
      document.body.appendChild(toggleBtn);
      console.log("Toggle button created");
    }
    
    function startPopupInterval() {
      setTimeout(function() {
        if (!chatClicked) {
          showPopupTooltip();
        }
      }, 5000);
      
      popupInterval = setInterval(function() {
        if (!chatClicked) {
          showPopupTooltip();
        }
      }, 60000);
    }
    
    function stopPopupInterval() {
      if (popupInterval) {
        clearInterval(popupInterval);
        popupInterval = null;
        console.log('Popup interval stopped');
      }
    }
    
    function showPopupTooltip() {
      var existingPopup = document.getElementById("chat-popup-tooltip");
      if (existingPopup || chatClicked) return;
      
      var popup = document.createElement("div");
      popup.id = "chat-popup-tooltip";
      popup.className = "chat-popup-tooltip";
      popup.textContent = popupMessage;
      
      popup.addEventListener("click", function(e) {
        if (e.target.className === 'chat-popup-close') return;
        
        chatClicked = true;
        hidePopupTooltip();
        stopPopupInterval();
        
        if (embeddedServiceInstance && typeof embeddedServiceInstance.utilAPI.launchChat === "function") {
          console.log("launchChat() from popup");
          var r = embeddedServiceInstance.utilAPI.launchChat();
          if (r && typeof r.then === "function") {
            r.then(function () {
              console.log("Chat launched from popup (Promise resolved)");
            }).catch(function (err) {
              console.error("Error launching chat from popup", err);
            });
          }
        }
      });
      
      var closeBtn = document.createElement("button");
      closeBtn.className = "chat-popup-close";
      closeBtn.textContent = "Ã—";
      closeBtn.addEventListener("click", function(e) {
        e.stopPropagation();
        hidePopupTooltip();
      });
      
      popup.appendChild(closeBtn);
      document.body.appendChild(popup);
      
      playNotificationSound();
      
      setTimeout(function() {
        hidePopupTooltip();
      }, 10000);
      
      console.log("Popup tooltip shown");
    }
    
    function hidePopupTooltip() {
      var popup = document.getElementById("chat-popup-tooltip");
      if (popup) {
        popup.style.animation = "none";
        popup.style.opacity = "0";
        popup.style.transform = "translateY(20px) scale(0.8)";
        setTimeout(function() {
          if (popup.parentNode) {
            popup.parentNode.removeChild(popup);
          }
        }, 300);
        console.log("Popup tooltip hidden");
      }
    }
    
    function hideCustomCTA() {
      var btn = document.getElementById("leap-chat-cta");
      if (btn) {
        btn.style.display = "none";
        console.log("Custom CTA hidden");
      }
    }
    
    function hideToggleButton() {
      var toggleBtn = document.getElementById("chat-toggle-btn");
      if (toggleBtn) {
        toggleBtn.style.display = "none";
        console.log("Toggle button hidden");
      }
    }
    
    function showToggleButton() {
      var toggleBtn = document.getElementById("chat-toggle-btn");
      if (toggleBtn) {
        toggleBtn.style.display = "block";
        console.log("Toggle button shown");
      }
    }
    
    window.addEventListener("onEmbeddedMessagingButtonCreated", function () {
      console.log("onEmbeddedMessagingButtonCreated fired");
      var es = window.embeddedservice_bootstrap;
      if (es) {
        showCustomCTA(es);
      }
    });
    
    window.addEventListener("onEmbeddedMessagingWindowMaximized", function () {
      console.log("onEmbeddedMessagingWindowMaximized fired");
      hideCustomCTA();
      hideToggleButton();  // Hide toggle button when chat opens
    });
    
    window.addEventListener("onEmbeddedMessagingWindowMinimized", function () {
      console.log("onEmbeddedMessagingWindowMinimized fired");
      var es = window.embeddedservice_bootstrap;
      if (es) {
        hideStandardButton(es);
        showCustomCTA(es);
        showToggleButton();  // Show toggle button when chat minimizes
      }
    });
    
    function waitForES(maxAttempts, intervalMs) {
      var attempts = 0;
      (function check() {
        attempts++;
        var es = window.embeddedservice_bootstrap;
        if (es && es.utilAPI) {
          console.log("utilAPI ready (initial)");
          showCustomCTA(es);
          return;
        }
        if (attempts >= maxAttempts) {
          console.warn("utilAPI not found after", attempts, "attempts");
          return;
        }
        setTimeout(check, intervalMs);
      })();
    }
    
    if (document.readyState === "complete" || document.readyState === "interactive") {
      waitForES(50, 200);
    } else {
      window.addEventListener("DOMContentLoaded", function () {
        waitForES(50, 200);
      });
    }
  })();
</script>
<script type="text/javascript" src="https://leapmotor--dev01.sandbox.my.site.com/ESWLPMLeapmotor1760706603231/assets/js/bootstrap.min.js" onload="initEmbeddedMessaging()"></scri
	
</body>

</html>











